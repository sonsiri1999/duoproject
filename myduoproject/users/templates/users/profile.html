{% extends "base.html" %}

{% block title %}ข้อมูลโปรไฟล์{% endblock %}

{% block content %}
<div class="bg-white p-8 rounded-xl shadow-lg mt-6">
    <h1 class="text-4xl font-extrabold text-gray-900 mb-6 border-b pb-2">ข้อมูลโปรไฟล์: {{ user.username }}</h1>
    
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        
        <!-- 1. Profile Update Form -->
        <div class="lg:col-span-1 bg-gray-50 p-6 rounded-lg shadow-inner">
            <h2 class="text-2xl font-semibold text-indigo-700 mb-4">อัปเดตข้อมูลส่วนตัว</h2>
            
            <form method="post" action="{% url 'users:profile' %}">
                {% csrf_token %}
                
                {% for field in profile_form %}
                    <div class="mb-4">
                        <label for="{{ field.id_for_label }}" class="block text-sm font-medium text-gray-700">
                            {{ field.label }}
                        </label>
                        {{ field }}
                        {% for error in field.errors %}
                            <p class="mt-1 text-sm text-red-600">{{ error }}</p>
                        {% endfor %}
                    </div>
                {% endfor %}
                
                <button type="submit" class="w-full py-2 px-4 rounded-md text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 transition">
                    บันทึกข้อมูล
                </button>
            </form>
        </div>

        <!-- 2. Order History -->
        <div class="lg:col-span-2">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4 border-b pb-2">ประวัติคำสั่งซื้อ</h2>
            
            {% if orders %}
                <div class="space-y-4">
                    {% for order in orders %}
                        <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm hover:shadow-md transition">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-lg font-bold text-indigo-800">
                                    คำสั่งซื้อ #{{ order.order_number }}
                                </span>
                                <span class="text-sm px-3 py-1 rounded-full 
                                    {% if order.status.name == 'สำเร็จ' %}bg-green-100 text-green-700{% elif order.status.name == 'ยกเลิก' %}bg-red-100 text-red-700{% else %}bg-yellow-100 text-yellow-700{% endif %}">
                                    {{ order.status.name }}
                                </span>
                            </div>
                            <p class="text-sm text-gray-600">วันที่: {{ order.created_at|date:"d M Y H:i" }}</p>
                            <p class="text-md font-semibold text-gray-800">ยอดรวม: {{ order.grand_total|floatformat:2 }} บาท</p>
                            <div class="mt-3 text-right">
                                <!-- FIX: ใช้ namespaced URL -->
                                <a href="{% url 'orders:order_detail' order_number=order.order_number %}" class="text-indigo-600 hover:text-indigo-800 text-sm font-medium">
                                    ดูรายละเอียด &rarr;
                                </a>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="text-center py-10 bg-gray-50 rounded-lg border border-dashed border-gray-300">
                    <p class="text-gray-500">คุณยังไม่มีประวัติการสั่งซื้อ</p>
                    <a href="{% url 'products:product_list' %}" class="mt-3 inline-block text-indigo-600 hover:text-indigo-800 text-sm font-medium">
                        เริ่มช้อปปิ้งเลย
                    </a>
                </div>
            {% endif %}
        </div>
        
    </div>
</div>
{% endblock %}
